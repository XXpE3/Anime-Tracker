# CLAUDE.md

本文件为 Claude Code (claude.ai/code) 在此代码库中工作时提供指导。

**禁止使用类型断言**，任何 `any` 都要避免
**禁止 git push 操作**，一 push 就会触发 CI/CD，导致自动部署，**因当由人类进行操作**

## 编码风格

代码风格应当遵循 Clean Code（整洁代码），思想的核心是编写可读、可理解、易于维护和扩展的代码，关注编程的细节、避免过度设计。

- 核心原则与实践
  - 可读性至上：代码是写给人读的，其次才是给机器执行的。
  - 只做一件事 (SRP)：一个函数、一个类应只负责一项功能。
  - 清晰的命名：变量、函数、类的名称应准确表达其意图。
  - 恰当的抽象：保持在同一抽象层，避免混杂不同层面的逻辑。
- 函数设计
  - 参数少于三个，超过三个考虑用对象封装。
  - 避免副作用（Side Effects）。
  - 向下规则：先声明后使用（或根据阅读习惯组织）。
- 原则
  - 代码即注释：好的代码本身不需要太多注释。
  - 有用的注释：解释算法、意图、历史或法律信息，而非重复代码。
  - 避免的注释：错误、误导性、无用（重复）的注释。
  - DRY 原则（Don't Repeat Yourself）：避免重复代码，但避免过度抽象。
  - 面向对象：多用多态，少用过多的条件语句 (if/switch)。
  - 重构：持续改进代码结构，不为烂代码找借口（不当破窗者）。

## 项目概述

一个用于通过 Mikan Project RSS 订阅源追踪和下载动漫的 Raycast 扩展。使用 React 和 Raycast API 构建。

## 命令

```bash
# 开发
npm run dev          # 启动 Raycast 开发模式 (ray dev)
npm run build        # 构建扩展 (ray build)
```

## 架构

### 命令 (位于 `src/`)

- **index.tsx** - 主 "Anime Tracker" 命令

  - 从 Mikan RSS 订阅源 (https://mikanani.me/RSS/Classic) 显示最新动漫
  - 按 "今天" 和 "最近" 更新分组显示项目
  - 通过 `LocalStorage` 实现本地缓存，缓存有效期为 30 分钟
  - 选中项目时延迟加载封面图片和文件大小
  - 支持暂存多个项目以批量复制磁力链接

- **anime-search.tsx** - "Anime Search" 命令
  - 基于网格的海报墙，用于按名称搜索动漫
  - 使用不同的 Mikan 镜像站 (mikan.tangbai.cc)
  - 推送导航显示每个动漫的资源列表
  - 支持按字幕组筛选的下拉菜单

### 关键模式

- **磁力链接提取**: 两个命令都通过正则表达式从详情页提取磁力链接，并使用缓存避免重复请求
- **HTML 实体解码**: 自定义 `decodeHtmlEntities()` 函数处理命名实体和数字实体
- **暂存系统**: 用户可以暂存多个项目，然后一次性批量复制所有磁力链接
- **操作模式**: `browser_pikpak` (复制 + 打开)、`download` (打开磁力链接)、`copy` (仅复制到剪贴板)

## 依赖

- `@raycast/api` - Raycast 扩展框架
- `rss-parser` - RSS/Atom 订阅源解析
